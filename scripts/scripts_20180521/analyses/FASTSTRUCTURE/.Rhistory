require(ggplot2)
require(reshape2)
calldate=20180806 # date genotypes were called
wd="/Users/annabelbeichman/Documents/UCLA/Otters/OtterExomeProject/results/analysisResults/FASTSTRUCTURE/"
plotoutdir=paste("/Users/annabelbeichman/Documents/UCLA/Otters/OtterExomeProject/results/plots/FASTSTRUCTURE/",calldate,sep="")
dir.create(plotoutdir)
require(rsvg)
i=5
samples <- read.table(paste(wd,calldate,"/snp_7_downSampCOM_maxNoCallFrac_0.2_passingBespoke_passingAllFilters_postMerge_raw_variants.samples",sep=""))
samples <- read.table(paste(wd,calldate,"/results/snp_7_downSampCOM_maxNoCallFrac_0.2_passingBespoke_passingAllFilters_postMerge_raw_variants.samples",sep=""))
colnames(samples) <- c("samples","population")
head(samples)
samplesPops <- read.table(paste(wd,calldate,"/results/",filePrefix,".popAssignmentsamples",sep=""))
filePrefix="snp_7_downSampCOM_maxNoCallFrac_0.2_passingBespoke_passingAllFilters_postMerge_raw_variants"
samplesPops <- read.table(paste(wd,calldate,"/results/",filePrefix,".popAssignmentsamples",sep=""))
colnames(samples) <- c("samples","population")
samplesPops <- read.table(paste(wd,calldate,"/results/",filePrefix,".popAssignmentsamples",sep=""))
samplesPops <- read.table(paste(wd,calldate,"/results/",filePrefix,".popAssignment",sep=""))
samplesPops <- read.table(paste(wd,calldate,"/results/",filePrefix,"manual.popAssignment",sep=""))
samplesPops <- read.table(paste(wd,calldate,"/results/",filePrefix,".manual.popAssignment",sep=""))
colnames(samplesPops) <- c("samples","population")
head(samplesPops)
meanQ <- read.table(paste(wd,calldate,"/",filePrefix,".faststructure_output.",i,".meanQ",sep=""))
meanQ <- read.table(paste(wd,calldate,"/results/",filePrefix,".faststructure_output.",i,".meanQ",sep=""))
head(meanQ)
full <- cbind(samples,meanQ)
head(full)
full.melt <- melt(full)
head(full.melt)
full <- cbind(samplesPops,meanQ)
head(full)
full.melt <- melt(full)
head(full.melt)
p0 <- ggplot(full.melt,aes(x=samples,y=value,fill=variable))+
geom_bar(stat="identity",position="stack")+
coord_flip()+
facet_wrap(~population,scales="free")+
theme_bw()
p0
ggsave(paste(plotoutdir,"/fastStructure.byPop.downSampleCOM.",calldate,".pdf",sep=""),p0,device="pdf",width = 17,height=8)
i=4
meanQ <- read.table(paste(wd,calldate,"/results/",filePrefix,".faststructure_output.",i,".meanQ",sep=""))
full <- cbind(samplesPops,meanQ)
head(full)
full.melt <- melt(full)
p0 <- ggplot(full.melt,aes(x=samples,y=value,fill=variable))+
geom_bar(stat="identity",position="stack")+
coord_flip()+
facet_wrap(~population,scales="free")+
theme_bw()
p0
ggsave(paste(plotoutdir,"/fastStructure.byPop.downSampleCOM.",i,".groups.",calldate,".pdf",sep=""),p0,device="pdf",width = 17,height=8)
library(gdsfmt)
library(SNPRelate)
require(ggplot2)
require(ggally)
require(ggrepel)
calldate=20180806 # date gt's were called in format YYYYMMDD
todaysdate=format(Sys.Date(),format="%Y%m%d")
indir=paste("/Users/annabelbeichman/Documents/UCLA/Otters/OtterExomeProject/results/datafiles/snps_gds/",calldate,"/",sep="") # this is where your snp vcf file is and where you will save your gds file (downloaded from hoffman)
plotoutdir=paste("/Users/annabelbeichman/Documents/UCLA/Otters/OtterExomeProject/results/plots/PCA/",calldate,"/",sep="")
fileoutdir=paste("/Users/annabelbeichman/Documents/UCLA/Otters/OtterExomeProject/results/analysisResults/PCA/",calldate,"/",sep="")
dir.create(plotoutdir,recursive = T)
dir.create(fileoutdir,recursive = T)
genofile <- snpgdsOpen(paste(indir,"snp_8_rmRelativesAdmixed_maxNoCallFrac_0.2_passingBespoke_passingAllFilters_postMerge_raw_variants.gds",sep=""))
snpset <- snpgdsLDpruning(genofile, ld.threshold=0.2,autosome.only = F)
head(snpset)
snpset.id <- unlist(snpset)
head(snpset.id)
